var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},Bird=function(t){function e(){var e=t.call(this)||this;return e._addSpeed=0,e._status=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this._image=RES.getRes("bird_png"),this.draw(),this._timer=new egret.Timer(40,0),this._timer.addEventListener(egret.TimerEvent.TIMER,this.updateSpeed,this),this._timer.start()},e.prototype.draw=function(){this._bitmap=new egret.Bitmap(this._image),this._bitmap.fillMode=egret.BitmapFillMode.CLIP,this._bitmap.width=53,this._bitmap.height=45,this.addChild(this._bitmap);var t=RES.getRes("newParticle_png"),e=RES.getRes("newParticle_json");this._particleSys=new particle.GravityParticleSystem(t,e),this._particleSys.x=-120,this._particleSys.y=-5,this.addChildAt(this._particleSys,0)},Object.defineProperty(e.prototype,"addSpeed",{set:function(t){this._addSpeed=t},enumerable:!0,configurable:!0}),e.prototype.updateSpeed=function(){0!=this._status&&this.y+10<Data.GetEarthHeight()-10&&(this.y+=this._addSpeed,this._addSpeed+=1.5)},e}(egret.Sprite);__reflect(Bird.prototype,"Bird");var Data=function(){function t(){}return t.GetStageWidth=function(){return 0==t._stageWidth&&(t._stageWidth=egret.MainContext.instance.stage.stageWidth),t._stageWidth},t.GetStageHeight=function(){return 0==t._stageHeight&&(t._stageHeight=egret.MainContext.instance.stage.stageHeight),t._stageHeight},t.GetEarthHeight=function(){return 6*t.GetStageHeight()/7},t.GetScore=function(){return t._score},t.AddScore=function(){t._score+=1},t.GetBirdRad=function(){return t._birdRad},t.GetPipeX=function(){return t.GetStageWidth()/4},t}();Data._stageWidth=0,Data._stageHeight=0,Data._score=0,Data._birdRad=20,Data._EarthWidth=10,Data._moveSpeed=5,__reflect(Data.prototype,"Data");var earth=function(t){function e(){var e=t.call(this)||this;return e.draw(),e}return __extends(e,t),e.prototype.draw=function(){this.graphics.beginFill(0),this.graphics.drawRect(0,0,Data.GetStageWidth(),Data._EarthWidth),this.graphics.endFill()},e}(egret.Sprite);__reflect(earth.prototype,"earth");var Game=function(){function t(t){this.number=0,this._moveLayer=[],this._index=0,this._root=t,this._touchFlag=!1,this._loadingView=new LoadingUI,this._root.addChild(this._loadingView),this._root.addEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this)}return t.prototype.onAddToStage=function(){this._root.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},t.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},t.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this._root.removeChild(this._loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this._root.addEventListener("GameOver",this.gameOver,this),this._moveTimer=new egret.Timer(50,0),this._moveTimer.addEventListener(egret.TimerEvent.TIMER,this.moveTimerFunc,this),this._contractTimer=new egret.Timer(20,0),this._contractTimer.addEventListener(egret.TimerEvent.TIMER,this.contractTimerFunc,this),this._addScoreTimer=new egret.Timer(50,0),this._addScoreTimer.addEventListener(egret.TimerEvent.TIMER,this.addScoreTimerFunc,this),this._score=new ScoreLabel,this._score.showText(),this._showScoreTimer=new egret.Timer(50,0),this._showScoreTimer.addEventListener(egret.TimerEvent.TIMER,this.showScoreTimerFunc,this),this._sound=RES.getRes("1_mp3"),this.draw(),this._img=new egret.Bitmap,this._img.texture=RES.getRes("earth_jpg"),this._img.width=Data.GetStageWidth(),this._img.height=Data.GetEarthHeight(),this._root.addChildAt(this._img,0),this.startgame())},t.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},t.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},t.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this._loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},t.prototype.soundPlay=function(){this._channel=this._sound.play(30,1),this._channel.addEventListener(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this)},t.prototype.soundStop=function(){this._channel&&(this._channel.removeEventListener(egret.Event.SOUND_COMPLETE,this.onSoundComplete,this),this._channel.stop(),this._channel=null)},t.prototype.onSoundComplete=function(t){console.log("播放完成"),this.soundStop()},t.prototype.draw=function(){this.CreateWorld(),this.CreateWorld(),this._moveLayer[1].x=Data.GetStageWidth(),this._bird=new Bird,this._root.addChildAt(this._bird,5);var t=new egret.Sprite;t.graphics.beginFill(16772045),t.graphics.drawRect(0,Data.GetEarthHeight()+10,Data.GetStageWidth(),Data.GetStageHeight()-Data.GetEarthHeight()-10),t.graphics.endFill(),this._root.addChildAt(t,0)},t.prototype.CreateWorld=function(){var t=new moverLayer;this._root.addChildAt(t,3),this._moveLayer.push(t)},t.prototype.onClick=function(t){this._bird.addSpeed=0;var e=egret.Tween.get(this._bird);e.to({y:this._bird.y-65},50).call(this.startBirdTimer).wait(150)},t.prototype.startBirdTimer=function(){},t.prototype.moveTimerFunc=function(){this._moveLayer[0].x-=Data._moveSpeed,this._moveLayer[1].x-=Data._moveSpeed,this._moveLayer[this._index].x<=-Data.GetStageWidth()&&(this._moveLayer[this._index].x=this._moveLayer[1-this._index].x+Data.GetStageWidth(),this._moveLayer[this._index].clearChildren(),this._moveLayer[this._index].CreatePiplineList(),this._index=1-this._index)},t.prototype.addScoreTimerFunc=function(){4==this._moveLayer[this._index].PipeArray.length&&((this._bird.x<=Data.GetStageWidth()/4+this._moveLayer[this._index].x+Data.GetStageWidth()/5+Data._moveSpeed/2&&this._bird.x>=Data.GetStageWidth()/4+this._moveLayer[this._index].x+Data.GetStageWidth()/5-Data._moveSpeed/2||this._bird.x<=3*Data.GetStageWidth()/4+this._moveLayer[this._index].x+Data.GetStageWidth()/5+Data._moveSpeed/2&&this._bird.x>=3*Data.GetStageWidth()/4+this._moveLayer[this._index].x+Data.GetStageWidth()/5-Data._moveSpeed/2)&&Data.AddScore(),0!=Data.GetScore()&&Data.GetScore()%3==0&&(Data._moveSpeed=10))},t.prototype.contractTimerFunc=function(){if(1==this._birdflag,this._moveLayer[this._index].GameEarth.y<=this._bird.y+Data.GetBirdRad()&&this._root.dispatchEventWith("GameOver"),4==this._moveLayer[this._index].PipeArray.length)for(var t=0;4>t;t++){var e=this._moveLayer[this._index].PipeArray[t].hitTestPoint(this._bird.x+50,this._bird.y+10),i=this._moveLayer[this._index].PipeArray[t].hitTestPoint(this._bird.x+25,this._bird.y+10),r=this._moveLayer[this._index].PipeArray[t].hitTestPoint(this._bird.x+25,this._bird.y+35),o=this._moveLayer[this._index].PipeArray[t].hitTestPoint(this._bird.x+50,this._bird.y+35);(1==e||1==i||1==r||1==o)&&(console.log("Contract Layer True"),this._root.dispatchEventWith("GameOver"))}},t.prototype.startgame=function(){this._birdflag=!1,Data._score=0,this._bird.x=100,this._bird.y=200,this._moveLayer[this._index].x=0,this._moveLayer[1-this._index].x=Data.GetStageWidth(),this._moveLayer[this._index].clearChildren(),this._img.touchEnabled=!0,this._img.addEventListener(egret.TouchEvent.TOUCH_TAP,this.imagClick,this)},t.prototype.imagClick=function(t){this._touchFlag||(this._root.touchEnabled=!0,this._root.addEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this._root.addChildAt(this._score,10),this._contractTimer.start(),this._moveTimer.start(),this._addScoreTimer.start(),this._showScoreTimer.start(),this._bird._status=1,this._touchFlag=!0,this.soundPlay(),this._bird._particleSys.start())},t.prototype.gameOver=function(){this._touchFlag=!1,this.soundStop(),this._contractTimer.stop(),this._moveTimer.stop(),this._addScoreTimer.stop(),this._showScoreTimer.stop(),this._birdflag=!1,this._bird._status=0,Data._moveSpeed=5,this._bird._particleSys.stop(),this._root.removeChild(this._score),this._root.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onClick,this),this._img.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.imagClick,this),this.gameover||(this.gameover=new GameOver,this.gameover.addEventListener("StartGame",this.startgame,this)),this._root.addChild(this.gameover)},t.prototype.showScoreTimerFunc=function(){this._score.showText()},t}();__reflect(Game.prototype,"Game");var GameOver=function(t){function e(){var e=t.call(this)||this;return e.draw(),e}return __extends(e,t),e.prototype.draw=function(){this.graphics.beginFill(1118481,.5),this.graphics.drawRect(0,0,Data.GetStageWidth(),Data.GetStageHeight()),this.graphics.endFill(),this._img=new egret.Bitmap,this._img.texture=RES.getRes("button_png"),this._img.fillMode=egret.BitmapFillMode.CLIP,this._img.width=170,this._img.height=105,this._img.x=Data.GetStageWidth()/2-170,this._img.y=Data.GetStageHeight()/2,this.addChildAt(this._img,0),this._img.touchEnabled=!0,this._img.addEventListener(egret.TouchEvent.TOUCH_TAP,this.startGame,this)},e.prototype.startGame=function(){this.parent.removeChild(this),this.dispatchEventWith("StartGame")},e}(egret.Sprite);__reflect(GameOver.prototype,"GameOver");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(t){function e(){var e=t.call(this)||this;new Game(e);return e}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var moverLayer=function(t){function e(){var e=t.call(this)||this;return e._canflyHeight=150,e._limitHeight=50,e._earthHeight=Data.GetEarthHeight(),e._pipeArray=[],e._pipeIndex=0,e._randPipX=Data.GetPipeX(),e.graphics.beginFill(16777215,0),e.graphics.drawRect(0,0,Data.GetStageWidth(),Data.GetStageHeight()),e.graphics.endFill(),e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this.draw()},e.prototype.draw=function(){this._earth=new earth,this._earth.y=this._earthHeight,this.addChild(this._earth),this.CreatePiplineList()},e.prototype.CreatePiplineList=function(){this.CreatePipline(this._randPipX),this._pipeIndex+=2,this.CreatePipline(3*this._randPipX)},e.prototype.CreatePipline=function(t){var e=new Pipes;e.rotation=180,e.x=t+50,this.addChildAt(e,4),this._pipeArray.push(e);var i=new Pipes;i.x=t,this.addChildAt(i,4),this._pipeArray.push(i),this.RandomHeight()},e.prototype.RandomHeight=function(){var t=Math.random()*(this._earthHeight-this._limitHeight-this._canflyHeight);t<=this._limitHeight&&(t=this._limitHeight),this._pipeArray[this._pipeIndex].PipeHeight=t,this._pipeArray[this._pipeIndex].y=t,this._pipeArray[this._pipeIndex+1].y=this._pipeArray[this._pipeIndex].PipeHeight+this._canflyHeight,this._pipeArray[this._pipeIndex+1].PipeHeight=this._earthHeight-this._pipeArray[this._pipeIndex].PipeHeight-this._canflyHeight},Object.defineProperty(e.prototype,"GameEarth",{get:function(){return this._earth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"PipeArray",{get:function(){return this._pipeArray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"PipeIndex",{get:function(){return this._pipeIndex},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"randPipx",{set:function(t){this._randPipX=t},enumerable:!0,configurable:!0}),e.prototype.clearChildren=function(){for(var t=this._pipeArray.length;t;){var e=this._pipeArray.pop();this.removeChild(e),--t}this._pipeIndex=0},e}(egret.Sprite);__reflect(moverLayer.prototype,"moverLayer");var Pipes=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(){this._image=RES.getRes("defens_jpg"),this.draw()},e.prototype.draw=function(){this._pipe=new egret.Bitmap(this._image),this._pipe.fillMode=egret.BitmapFillMode.REPEAT,this._pipe.width=50,this.width=50,this.addChild(this._pipe)},Object.defineProperty(e.prototype,"PipeHeight",{get:function(){return this._height},set:function(t){this._height=t,this._pipe.height=this._height},enumerable:!0,configurable:!0}),e.prototype.getPipeWidth=function(){return console.log(this._pipe.$getWidth()),this._pipe.width},e}(egret.Sprite);__reflect(Pipes.prototype,"Pipes");var ScoreLabel=function(t){function e(){var e=t.call(this)||this;return e.draw(),e}return __extends(e,t),e.prototype.draw=function(){this._txt=new egret.TextField,this._txt.width=Data.GetStageWidth(),this._txt.y=100,this._txt.textColor=16711680,this._txt.textAlign=egret.HorizontalAlign.CENTER,this.addChild(this._txt)},e.prototype.showText=function(){this._txt.text="COMBO: "+Data.GetScore().toString()},e}(egret.Sprite);__reflect(ScoreLabel.prototype,"ScoreLabel");